Việc tạo 1 biến  Blink_Rate trong hàm timer_run() để đếm số lần ngắt thì việc thay đổi thời gian ngắt của bộ ngắt timer sẽ không ảnh hưởng tới tần số chớp tắt LED. Chúng ta chỉ cần thay đổi giá trị của biến Blink_Rate để đảm bảo LED chớp tắt với tần số 2Hz. Ví dụ, nếu thay đổi thời gian ngắt từ 10ms thành 1ms thì chỉ cần tăng giá trị biến Blink_Rate thành 250.

#define Blink_Rate  25; //time off= time on= 250ms
int timer0_counter = Blink_Rate;



////////////////////////////////////////////////////////////


void timer_run(){
	if (timer0_counter>0){
		timer0_counter--;
		if (timer0_counter==0){
			HAL_GPIO_TogglePin(LED_RED_GPIO_Port, LED_RED_Pin);
			timer0_counter=Blink_Rate;
		}
	}
}


void HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim) {
	timer_run();
}